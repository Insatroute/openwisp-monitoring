{% load i18n static %}


{% for pf in device_data.firewall.port_forward %}
  {# pf.redirects is a dict mapping dest_ip → list of rules #}
  {% for dest_ip, rules in pf.redirects.items %}
    <div class="destination-label">
      {% trans "Destination" %}: {{ dest_ip }}
    </div>

    <table class="disk" id="port-forward-table-{{ dest_ip|slugify }}">
      <thead>
        <tr>
          <th>{% trans "Name" %}</th>
          <th>{% trans "Source port" %}</th>
          <th>{% trans "Destination port" %}</th>
          <th>{% trans "Protocols" %}</th>
          <th>{% trans "WAN IP" %}</th>
          <th>{% trans "Restrict access from" %}</th>
          <th>{% trans "Status" %}</th>
        </tr>
      </thead>
      <tbody id="port-forward-body-{{ dest_ip|slugify }}">
        {% for rule in rules %}
        <tr>
          <td data-label="{% trans 'Name' %}">
            {{ rule.name }}
          </td>
          <td data-label="{% trans 'Source port' %}">
            {{ rule.source_port }}
            {% if rule.source_port_name %} ({{ rule.source_port_name }}){% endif %}
          </td>
          <td data-label="{% trans 'Destination port' %}">
            {{ rule.destination_port }}
          </td>
          <td data-label="{% trans 'Protocols' %}">
            {{ rule.protocol|join:", "|upper }}
          </td>
          <td data-label="{% trans 'WAN IP' %}">
            {{ rule.wan|capfirst }}
          </td>
          <td data-label="{% trans 'Restrict access from' %}">
            {% if rule.restrict %}
              {{ rule.restrict }}
            {% else %}
              –
            {% endif %}
          </td>
          <td data-label="{% trans 'Status' %}">
            {% if rule.enabled %}
              <span class="status-icon enabled">✔</span>
              {% trans "Enabled" %}
            {% else %}
              <span class="status-icon disabled">✖</span>
              {% trans "Disabled" %}
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {# Pagination controls (reuse the same JS/pattern as before) #}
    <div id="pf-pagination-{{ dest_ip|slugify }}" class="pagination-controls"></div>
  {% endfor %}
{% endfor %}

<style>
.destination-label{
    color: white;
    background-color: #253a5d;
    width: 180px;
    font-weight: 500;
    padding: 2px 0px 2px 10px;
    border-radius: 0px 20px 0px 0px;
    }

</style>
