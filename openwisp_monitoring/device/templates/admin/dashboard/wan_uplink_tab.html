{# wan_uplink.html - WAN Uplink tab: single summary card + table #}

<style>
    /* ======= SUMMARY CARD (LIKE DATA USAGE SUMMARY) ======= */
    .wan-summary-wrap {
        /* max-width: 1200px; */
        margin: 10px auto 18px;
        font-family: inherit;
    }

    .wan-summary-title {
        margin: 0 0 6px 0;
        font-size: 14px;
        font-weight: 600;
        color: #4b5563;
    }

    .wan-summary-card {
        background: #ffffff;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(15, 23, 42, .08);
        border: 1px solid #f3f4f6;
        padding: 14px 18px;
        display: flex;
        gap: 0;
    }

    .wan-summary-item {
        flex: 1 1 0;
        padding: 4px 18px;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .wan-summary-item+.wan-summary-item {
        border-left: 1px solid #e5e7eb;
        /* vertical dash between items */
    }

    .wan-summary-label {
        font-size: 13px;
        color: #6b7280;
    }

    .wan-summary-main {
        display: flex;
        align-items: baseline;
        gap: 4px;
    }

    .wan-summary-value {
        font-size: 20px;
        font-weight: 700;
        color: #111827;
    }

    .wan-summary-unit {
        font-size: 12px;
        color: #9ca3af;
    }

    .wan-summary-sub {
        font-size: 11px;
        color: #9ca3af;
    }

    .wan-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        display: inline-block;
        margin-right: 4px;
    }

    .wan-dot-green {
        background: #22c55e;
    }

    .wan-dot-amber {
        background: #f59e0b;
    }

    .wan-dot-gray {
        background: #9ca3af;
    }

    .wan-dot-silver {
        background: #d1d5db;
    }

    @media (max-width: 900px) {
        .wan-summary-card {
            flex-direction: column;
        }

        .wan-summary-item+.wan-summary-item {
            border-left: none;
            border-top: 1px solid #e5e7eb;
        }
    }

    /* ========= TABLE SHELL ========= */
    .home-wan-table-wrap {
        background: #fff;
        border: 1px solid #e5e7eb;
        box-shadow: 0 6px 18px rgba(15, 23, 42, .06);
        overflow: hidden;
        margin: 0 0 0;
    }

    .home-wan-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 12px;
    }

    .home-wan-table thead th {
        text-align: left;
        padding: 10px 12px;
        border-bottom: 1px solid #eef0f3;
        background: #f9fafb;
        font-size: 11px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: .03em;
        color: #6b7280;
        white-space: nowrap;
    }

    .home-wan-table tbody td {
        padding: 10px 12px;
        border-bottom: 1px solid #f1f5f9;
        vertical-align: middle;
    }

    .home-wan-table tbody tr:last-child td {
        border-bottom: none;
    }

    .home-wan-status-cell {
        white-space: nowrap;
    }

    .home-wan-status-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 999px;
        margin-right: 6px;
        vertical-align: middle;
    }

    .home-wan-status-connected {
        background: #22c55e;
    }

    .home-wan-status-disconnected {
        background: #9ca3af;
    }

    .home-wan-status-abnormal {
        background: #f59e0b;
    }

    .home-wan-status-disabled {
        background: #d1d5db;
    }

    .home-wan-linkish {
        color: #0b63c5;
        font-weight: 600;
        text-decoration: none;
    }

    .home-wan-linkish:hover {
        text-decoration: underline;
    }

    .home-wan-throughput {
        white-space: nowrap;
    }

    .home-wan-kp {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-right: 12px;
    }

    .home-wan-kp i {
        display: inline-block;
        width: 0;
        height: 0;
        border-left: 4px solid transparent;
        border-right: 4px solid transparent;
    }

    .home-wan-kp-up i {
        border-bottom: 7px solid #22c55e;
    }

    .home-wan-kp-down i {
        border-top: 7px solid #9ca3af;
    }

    .home-wan-muted {
        color: #9ca3af;
    }

    .home-wan-nowrap {
        white-space: nowrap;
    }

    @media (max-width: 900px) {
        .home-wan-table thead {
            font-size: 11px;
        }
    }
</style>

{# ====== SINGLE SUMMARY CARD ====== #}
<div class="wan-summary-wrap">
    <div class="wan-summary-title">Summary</div>
    <div class="wan-summary-card">
        <!-- Total -->
        <div class="wan-summary-item">
            <div class="wan-summary-label">Total WAN Uplinks</div>
            <div class="wan-summary-main">
                <span class="wan-summary-value" id="home-wan-total">0</span>
                <span class="wan-summary-unit">links</span>
            </div>
            <div class="wan-summary-sub">All WAN interfaces (including cellular)</div>
        </div>

        <!-- Connected -->
        <div class="wan-summary-item">
            <div class="wan-summary-label">Connected</div>
            <div class="wan-summary-main">
                <span class="wan-dot wan-dot-green"></span>
                <span class="wan-summary-value" id="home-wan-connected">0</span>
            </div>
            <div class="wan-summary-sub">Currently online</div>
        </div>

        <!-- Abnormal -->
        <div class="wan-summary-item">
            <div class="wan-summary-label">Abnormal</div>
            <div class="wan-summary-main">
                <span class="wan-dot wan-dot-amber"></span>
                <span class="wan-summary-value" id="home-wan-abnormal">0</span>
            </div>
            <div class="wan-summary-sub">Degraded / error state</div>
        </div>

        <!-- Disconnected + Disabled -->
        <div class="wan-summary-item">
            <div class="wan-summary-label">Disconnected</div>
            <div class="wan-summary-main">
                <span class="wan-dot wan-dot-gray"></span>
                <span class="wan-summary-value" id="home-wan-disconnected">0</span>
            </div>
            <div class="wan-summary-sub">
                <span class="wan-dot wan-dot-silver"></span>
                Disabled:
                <span id="home-wan-disabled">0</span>
            </div>
        </div>
    </div>
</div>

{# ========= TABLE ========= #}
<div class="home-wan-table-wrap">
    <table class="home-wan-table">
        <thead>
            <tr>
                <th>Status</th>
                <th>Uplink</th>
                <th>Uptime</th>
                <th>Interface IP/Mask</th>
                <th>Ping Destination</th>
                <th>Throughput</th>
                <th>Latency</th>
                <th>Jitter</th>
                <th>Loss</th>
            </tr>
        </thead>
        <tbody id="home-wan-tbody">

            {% for iface in device_data.interfaces %}
            {% if iface.is_wan or iface.type == 'mobile' %}
            {# skip sub-interfaces like eth0.10 or eth0-1 #}
            {% if iface.name|cut:'.' == iface.name and iface.name|cut:'-' == iface.name %}

            {% with iface.up|yesno:"connected,disconnected" as status_label %}

            <tr data-status="{{ status_label }}" data-uplink="{{ iface.name|upper }}">
                <td class="home-wan-status-cell">
                    <span class="home-wan-status-dot home-wan-status-{{ status_label }}"></span>
                    {{ status_label|capfirst }}
                </td>

                <td class="home-wan-nowrap">
                    {% if iface.type == 'mobile' %}
                    {% if iface.name == 'modem' %}
                    <a class="home-wan-linkish">Cellular (SIM1)</a>
                    {% elif iface.name == 'modem2' %}
                    <a class="home-wan-linkish">Cellular (SIM2)</a>
                    {% else %}
                    <a class="home-wan-linkish">{{ iface.name|upper }}</a>
                    {% endif %}
                    {% else %}
                    <a class="home-wan-linkish">{{ iface.name|upper }}</a>
                    {% endif %}
                </td>

                <td class="home-wan-nowrap">—</td>

                <td>
                    {% if iface.addresses %}
                    {% for addr in iface.addresses %}
                    <div>
                        {{ addr.address }}{% if addr.mask %}/{{ addr.mask }}{% endif %}
                        <span class="home-wan-muted"> ({{ addr.family|upper }})</span>
                    </div>
                    {% endfor %}
                    {% else %}
                    <span class="home-wan-muted">—</span>
                    {% endif %}
                </td>

                <td class="home-wan-nowrap">—</td>

                <td class="home-wan-throughput">
                    <span class="home-wan-kp home-wan-kp-up">
                        <i></i>{{ iface.statistics.tx.bytes|default:0|filesizeformat }}
                    </span>
                    <span class="home-wan-kp home-wan-kp-down">
                        <i></i>{{ iface.statistics.rx.bytes|default:0|filesizeformat }}
                    </span>
                </td>

                <td class="home-wan-nowrap">—</td>
                <td class="home-wan-nowrap">—</td>
                <td class="home-wan-nowrap">—</td>
            </tr>

            {% endwith %}
            {% endif %}
            {% endif %}

            {% empty %}
            {# STATIC FALLBACK WHEN NO device_data #}
            <tr data-status="connected" data-uplink="WAN1">
                <td class="home-wan-status-cell">
                    <span class="home-wan-status-dot home-wan-status-connected"></span>
                    Connected
                </td>
                <td class="home-wan-nowrap"><a class="home-wan-linkish">WAN1</a></td>
                <td class="home-wan-nowrap">4 weeks 1 day 20 hours</td>
                <td>
                    <div>203.0.113.10/24 <span class="home-wan-muted">(IPV4)</span></div>
                </td>
                <td class="home-wan-nowrap">8.8.8.8</td>
                <td class="home-wan-throughput">
                    <span class="home-wan-kp home-wan-kp-up"><i></i>3.62 GB</span>
                    <span class="home-wan-kp home-wan-kp-down"><i></i>2.83 GB</span>
                </td>
                <td class="home-wan-nowrap">15 ms</td>
                <td class="home-wan-nowrap">0.6 ms</td>
                <td class="home-wan-nowrap">0.0%</td>
            </tr>

            <tr data-status="connected" data-uplink="WAN2">
                <td class="home-wan-status-cell">
                    <span class="home-wan-status-dot home-wan-status-connected"></span>
                    Connected
                </td>
                <td class="home-wan-nowrap"><a class="home-wan-linkish">WAN2</a></td>
                <td class="home-wan-nowrap">1 month 5 days 23 hours</td>
                <td>
                    <div>198.51.100.24/24 <span class="home-wan-muted">(IPV4)</span></div>
                </td>
                <td class="home-wan-nowrap">1.1.1.1</td>
                <td class="home-wan-throughput">
                    <span class="home-wan-kp home-wan-kp-up"><i></i>4.88 GB</span>
                    <span class="home-wan-kp home-wan-kp-down"><i></i>3.74 GB</span>
                </td>
                <td class="home-wan-nowrap">18 ms</td>
                <td class="home-wan-nowrap">0.8 ms</td>
                <td class="home-wan-nowrap">0.1%</td>
            </tr>

            <tr data-status="disconnected" data-uplink="WAN3">
                <td class="home-wan-status-cell">
                    <span class="home-wan-status-dot home-wan-status-disconnected"></span>
                    Disconnected
                </td>
                <td class="home-wan-nowrap"><a class="home-wan-linkish">WAN3</a></td>
                <td class="home-wan-nowrap">—</td>
                <td><span class="home-wan-muted">—</span></td>
                <td class="home-wan-nowrap">8.8.4.4</td>
                <td class="home-wan-throughput">
                    <span class="home-wan-kp home-wan-kp-up"><i></i>0 B</span>
                    <span class="home-wan-kp home-wan-kp-down"><i></i>0 B</span>
                </td>
                <td class="home-wan-nowrap">—</td>
                <td class="home-wan-nowrap">—</td>
                <td class="home-wan-nowrap">—</td>
            </tr>
            {% endfor %}

        </tbody>
    </table>
</div>

<script>
    (function () {
        const tbody = document.getElementById('home-wan-tbody');
        if (!tbody) return;

        const rows = Array.from(tbody.querySelectorAll('tr'));

        const totalEl = document.getElementById('home-wan-total');
        const connectedEl = document.getElementById('home-wan-connected');
        const abnormalEl = document.getElementById('home-wan-abnormal');
        const disconnectedEl = document.getElementById('home-wan-disconnected');
        const disabledEl = document.getElementById('home-wan-disabled');

        function updateSummary() {
            let total = 0,
                connected = 0,
                abnormal = 0,
                disconnected = 0,
                disabled = 0;

            rows.forEach(row => {
                total++;
                const st = (row.dataset.status || '').toLowerCase();
                if (st === 'connected') connected++;
                else if (st === 'abnormal') abnormal++;
                else if (st === 'disconnected') disconnected++;
                else if (st === 'disabled') disabled++;
            });

            if (totalEl) totalEl.textContent = total;
            if (connectedEl) connectedEl.textContent = connected;
            if (abnormalEl) abnormalEl.textContent = abnormal;
            if (disconnectedEl) disconnectedEl.textContent = disconnected;
            if (disabledEl) disabledEl.textContent = disabled;
        }

        updateSummary();
    })();
</script>